{# Kompakte, tipp-freundliche Kartenliste für kleine Screens #}
<div class="ticket-cards">
  {% for ticket in tickets %}
    <div class="tc-card">
      <div class="tc-row tc-top">
        <a class="tc-id" href="{% url 'ticket_detail' id=ticket.id %}">#{{ ticket.id }}</a>
        <div class="tc-badges">
          {% if ticket.completed %}
            <span class="badge badge-danger"><i class="fas fa-lock"></i> Geschlossen</span>
          {% else %}
            <span class="badge badge-success"><i class="fas fa-lock-open"></i> Offen</span>
          {% endif %}
          <span class="badge badge-{{ ticket.priority_color }}">
            <i class="fas fa-business-time"></i> {{ ticket.priority_text }}
          </span>
        </div>
      </div>

      <a class="tc-category" href="{% url 'ticket_detail' id=ticket.id %}">
        {{ ticket.category }}
      </a>
      {% if ticket.title %}
        <div class="tc-title">{{ ticket.title }}</div>
      {% endif %}

      <div class="tc-meta">
        <div><i class="far fa-calendar-plus"></i> {{ ticket.created_date }}</div>
        <div><i class="far fa-user"></i> {{ ticket.created_by.first_name|slice:":2" }} {{ ticket.created_by.last_name }}</div>
      </div>

      <div class="tc-meta">
        <div><i class="far fa-edit"></i> {{ ticket.last_modified }}</div>
        <div><i class="far fa-user-cog"></i> {{ ticket.modified_by.first_name|slice:":2" }} {{ ticket.modified_by.last_name }}</div>
      </div>

      <div class="tc-meta">
        <div><i class="fas fa-user-check"></i>  {{ ticket.assigned_to.first_name|default:""|slice:":2" }} {{ ticket.assigned_to.last_name|default:"—" }}</div>
      </div>

      <div class="tc-actions">
        <a class="btn btn-primary btn-sm" title="Anzeigen" href="{% url 'ticket_detail' id=ticket.id %}">
          <i class="fas fa-eye"></i>
        </a>

        {% if user.is_staff or user == ticket.created_by %}
          <a class="btn btn-info btn-sm" title="Bearbeiten" href="{% url 'edit_ticket' id=ticket.id %}">
            <i class="fas fa-pencil-alt"></i>
          </a>
        {% endif %}

        {% if user.is_staff %}
          <form id="ticket_{{ ticket.id }}_actions_m" method="post" action="{% url 'ticket_detail' id=ticket.id %}">
            {% csrf_token %}
            {% if ticket.completed %}
              <button class="btn btn-warning btn-sm" name="open" value="open" title="Wieder öffnen">
                <i class="fas fa-lock-open"></i>
              </button>
            {% else %}
              <button class="btn btn-danger btn-sm" name="close" value="close" title="Schließen">
                <i class="fas fa-lock"></i>
              </button>
            {% endif %}
            <button type="button" class="btn btn-secondary btn-sm"
                    onclick="copy_link('{{ ticket.teams_deep_link }}', '{{ ticket.detail_page }}')"
                    title="Link kopieren">
              <i class="fas fa-copy"></i>
            </button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
<script>
    function copy_link(teams_deep_link, detail_link) {
        // If in iFrame:
        if (window.location !== window.parent.location) {
            Swal.fire({
                title: 'Link kopieren',
                text: 'Drück auf STRG-C um den Link zu kopieren',
                icon: 'info',
                input: 'url',
                inputLabel: 'Link zum Ticket',
                inputValue: teams_deep_link
            })
        } else {
            navigator.clipboard.writeText(detail_link);
            $(document).Toasts('create', {
                class: 'bg-success',
                title: 'Link zum Ticket kopiert',
                autohide: true,
                delay: 1000
            })
        }
    }
</script>
{# nutzt deine bestehende copy_link()-Funktion aus ticket_table.html #}
